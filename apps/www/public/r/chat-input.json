{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "chat-input",
  "title": "Chat Input",
  "description": "A chat input component.",
  "dependencies": [
    "motion",
    "lucide-react"
  ],
  "registryDependencies": [
    "@lumi-ui/button",
    "@lumi-ui/dialog",
    "@lumi-ui/scroll-area"
  ],
  "files": [
    {
      "path": "registry/ai/chat-input.tsx",
      "content": "\"use client\";\n\nimport { CornerRightUp, Loader2, Paperclip, XIcon } from \"lucide-react\";\nimport {\n  AnimatePresence,\n  type HTMLMotionProps,\n  MotionConfig,\n  motion,\n  type Transition,\n} from \"motion/react\";\nimport * as React from \"react\";\nimport { cn } from \"@/registry/lib/utils\";\nimport { Button } from \"@/registry/ui/button\";\nimport {\n  createDialogHandle,\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/registry/ui/dialog\";\nimport { ScrollArea } from \"@/registry/ui/scroll-area\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"../ui/tooltip\";\n\nconst chatInputTransition: Transition = {\n  bounce: 0.1,\n  duration: 0.4,\n  ease: [0.32, 0.72, 0, 1],\n  type: \"spring\",\n};\n\nconst textareaTransition: Transition = {\n  duration: 0.18,\n  ease: \"easeOut\",\n};\n\nfunction composeRefs<T>(\n  ...refs: Array<React.ForwardedRef<T> | undefined>\n): React.RefCallback<T> {\n  return (node) => {\n    for (const ref of refs) {\n      if (!ref) continue;\n      if (typeof ref === \"function\") {\n        ref(node);\n        continue;\n      }\n      ref.current = node;\n    }\n  };\n}\nfunction getAttachmentKind(attachment: ChatInputAttachmentData): string {\n  if (attachment.kind?.trim()) return attachment.kind;\n\n  const extension = attachment.label.split(\".\").pop()?.toLowerCase();\n  return extension || \"file\";\n}\n\nfunction useChatInputAutoResize({\n  maxHeight = 220,\n  minHeight = 84,\n}: {\n  maxHeight?: number;\n  minHeight?: number;\n}) {\n  const textareaRef = React.useRef<HTMLTextAreaElement>(null);\n  const [height, setHeight] = React.useState(minHeight);\n\n  const recalculateHeight = React.useCallback(() => {\n    const textarea = textareaRef.current;\n    if (!textarea) return;\n\n    const isCaretAtEnd =\n      textarea.selectionStart === textarea.value.length &&\n      textarea.selectionEnd === textarea.value.length;\n\n    textarea.style.height = `${minHeight}px`;\n\n    const nextHeight = Math.max(\n      minHeight,\n      Math.min(textarea.scrollHeight, maxHeight),\n    );\n\n    textarea.style.height = `${nextHeight}px`;\n    if (isCaretAtEnd) {\n      textarea.scrollTop = textarea.scrollHeight;\n    }\n    setHeight((prev) => (prev === nextHeight ? prev : nextHeight));\n  }, [maxHeight, minHeight]);\n\n  return {\n    height,\n    recalculateHeight,\n    textareaRef,\n  };\n}\n\nfunction useMeasuredHeight(active: boolean) {\n  const contentRef = React.useRef<HTMLDivElement>(null);\n  const [height, setHeight] = React.useState(0);\n\n  React.useLayoutEffect(() => {\n    if (!active) {\n      setHeight(0);\n      return;\n    }\n\n    const node = contentRef.current;\n    if (!node) return;\n\n    const updateHeight = () => {\n      setHeight(node.getBoundingClientRect().height);\n    };\n\n    updateHeight();\n\n    if (typeof ResizeObserver === \"undefined\") return;\n\n    const observer = new ResizeObserver(updateHeight);\n    observer.observe(node);\n\n    return () => {\n      observer.disconnect();\n    };\n  }, [active]);\n\n  return {\n    contentRef,\n    height,\n  };\n}\n\nfunction ChatInputRoot({ className, ...props }: HTMLMotionProps<\"div\">) {\n  return (\n    <motion.div\n      className={cn(\n        \"w-full overflow-hidden rounded-md border bg-background\",\n        className,\n      )}\n      layout\n      transition={chatInputTransition}\n      {...props}\n    />\n  );\n}\n\ninterface ChatInputTextareaProps\n  extends Omit<HTMLMotionProps<\"textarea\">, \"value\"> {\n  maxHeight?: number;\n  minHeight?: number;\n  onSubmitShortcut?: () => void;\n  onValueChange: (value: string) => void;\n  submitOnEnter?: boolean;\n  value: string;\n}\n\nfunction ChatInputTextarea({\n  className,\n  maxHeight = 220,\n  minHeight = 84,\n  onChange,\n  onKeyDown,\n  onSubmitShortcut,\n  onValueChange,\n  submitOnEnter = true,\n  value,\n  ref,\n  ...props\n}: ChatInputTextareaProps) {\n  const { height, recalculateHeight, textareaRef } = useChatInputAutoResize({\n    maxHeight,\n    minHeight,\n  });\n\n  const mergedRef = composeRefs(textareaRef, ref);\n\n  React.useLayoutEffect(() => {\n    const isEmpty = value.trim().length === 0;\n\n    if (isEmpty) {\n      setTimeout(() => {\n        recalculateHeight();\n      }, 0);\n      return;\n    }\n\n    recalculateHeight();\n  }, [value, recalculateHeight]);\n\n  const handleChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {\n    onValueChange(event.target.value);\n    onChange?.(event);\n    requestAnimationFrame(recalculateHeight);\n  };\n\n  const handleKeyDown = (event: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (\n      submitOnEnter &&\n      event.key === \"Enter\" &&\n      !event.shiftKey &&\n      !event.nativeEvent.isComposing\n    ) {\n      event.preventDefault();\n      onSubmitShortcut?.();\n    }\n\n    onKeyDown?.(event);\n  };\n\n  return (\n    <motion.textarea\n      animate={{ height }}\n      className={cn(\n        \"w-full resize-none overflow-y-auto overscroll-contain rounded-none border-none outline-none bg-transparent px-3 py-4 text-sm shadow-none\",\n        \"placeholder:text-muted-foreground\",\n        \"focus-visible:outline-none will-change-height\",\n        className,\n      )}\n      onChange={handleChange}\n      onKeyDown={handleKeyDown}\n      ref={mergedRef}\n      style={{ height }}\n      transition={textareaTransition}\n      value={value}\n      {...props}\n    />\n  );\n}\n\nfunction ChatInputToolbar({ className, ...props }: HTMLMotionProps<\"div\">) {\n  return (\n    <motion.div\n      className={cn(\n        \"flex items-center justify-between gap-2 bg-background px-2 py-2\",\n        className,\n      )}\n      layout\n      transition={chatInputTransition}\n      {...props}\n    />\n  );\n}\n\nfunction ChatInputActions({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      className={cn(\"flex items-center gap-2\", className)}\n      data-slot=\"chat-input-actions\"\n      {...props}\n    />\n  );\n}\n\nfunction ChatInputAttachButton({\n  children,\n  className,\n  size = \"icon-sm\",\n  type = \"button\",\n  variant = \"ghost\",\n  tooltipContent = \"Attach files\",\n  ...props\n}: React.ComponentProps<typeof Button> & {\n  tooltipContent?: React.ReactNode;\n}) {\n  return (\n    <Tooltip>\n      <TooltipTrigger\n        render={\n          <Button\n            className={cn(\"group\", className)}\n            size={size}\n            type={type}\n            variant={variant}\n            {...props}\n          >\n            {children ?? (\n              <Paperclip className=\"size-4 text-muted-foreground group-hover:text-foreground\" />\n            )}\n            <span className=\"sr-only\">Attach files</span>\n          </Button>\n        }\n      />\n      <TooltipContent showArrow={false} side=\"bottom\" sideOffset={4}>\n        {tooltipContent}\n      </TooltipContent>\n    </Tooltip>\n  );\n}\n\nfunction ChatInputSubmitButton({\n  ariaLabel = \"Send message\",\n  className,\n  isSubmitting = false,\n  size = \"icon-sm\",\n  type = \"button\",\n  variant = \"secondary\",\n  ...props\n}: Omit<React.ComponentProps<typeof Button>, \"children\"> & {\n  ariaLabel?: string;\n  isSubmitting?: boolean;\n}) {\n  return (\n    <Button\n      aria-label={ariaLabel}\n      className={cn(\"rounded-lg\", className)}\n      isLoading={isSubmitting}\n      size={size}\n      type={type}\n      variant={variant}\n      {...props}\n    >\n      {isSubmitting ? (\n        <Loader2 className=\"size-4 animate-spin\" />\n      ) : (\n        <CornerRightUp className=\"size-4\" />\n      )}\n    </Button>\n  );\n}\n\nfunction ChatInputAttachments({\n  children,\n  className,\n  position = \"top\",\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  position?: \"bottom\" | \"top\";\n}) {\n  const hasChildren = React.Children.count(children) > 0;\n  const { contentRef, height } = useMeasuredHeight(hasChildren);\n\n  return (\n    <AnimatePresence initial={false} mode=\"sync\">\n      {hasChildren ? (\n        <motion.div\n          animate={{ height: height || 0 }}\n          className=\"overflow-hidden\"\n          exit={{ height: 0 }}\n          initial={{ height: 0 }}\n          key=\"chat-input-attachments\"\n          transition={chatInputTransition}\n        >\n          <div\n            className={cn(\n              \"bg-background px-3 py-4\",\n              position === \"top\" ? \"border-b\" : \"border-t\",\n              className,\n            )}\n            ref={contentRef}\n            {...props}\n          >\n            {children}\n          </div>\n        </motion.div>\n      ) : null}\n    </AnimatePresence>\n  );\n}\n\nfunction ChatInputAttachmentItem({\n  className,\n  ...props\n}: HTMLMotionProps<\"div\">) {\n  return (\n    <motion.div\n      className={cn(\n        \"group relative size-28 z-10 bg-muted rounded-md\",\n        className,\n      )}\n      layout\n      transition={chatInputTransition}\n      {...props}\n    />\n  );\n}\n\nfunction ChatInputAttachmentLabel({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      className={cn(\n        \"line-clamp-2 text-xs font-medium text-foreground\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction ChatInputAttachmentMeta({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      className={cn(\"text-[10px] text-muted-foreground\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction ChatInputAttachmentRemove({\n  className,\n  size = \"icon-xs\",\n  type = \"button\",\n  variant = \"secondary\",\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  return (\n    <Button\n      className={cn(\n        \"absolute -left-2 -top-2 z-20 rounded-full hover:bg-secondary opacity-0 transition-opacity group-hover:opacity-100\",\n        className,\n      )}\n      size={size}\n      type={type}\n      variant={variant}\n      {...props}\n    >\n      <XIcon className=\"size-3\" />\n      <span className=\"sr-only\">Remove attachment</span>\n    </Button>\n  );\n}\n\ninterface ChatInputAttachmentData {\n  id: string;\n  kind?: string;\n  label: string;\n  meta?: string;\n  previewAlt?: string;\n  previewImageUrl?: string;\n  previewText?: string;\n}\n\ninterface ChatInputAttachmentPreviewDialogProps {\n  attachment: ChatInputAttachmentData | null;\n  onOpenChange: (open: boolean) => void;\n  open: boolean;\n  renderPreview?: (\n    attachment: ChatInputAttachmentData,\n  ) => React.ReactNode | undefined;\n}\n\ninterface ChatInputAttachmentPreviewContentProps {\n  attachment: ChatInputAttachmentData;\n  renderPreview?: (\n    attachment: ChatInputAttachmentData,\n  ) => React.ReactNode | undefined;\n}\n\nfunction ChatInputAttachmentPreviewContent({\n  attachment,\n  renderPreview,\n}: ChatInputAttachmentPreviewContentProps) {\n  const customPreview = renderPreview?.(attachment);\n  const hasImagePreview = Boolean(attachment.previewImageUrl);\n  const hasTextPreview = Boolean(attachment.previewText?.trim());\n\n  return (\n    <DialogContent className=\"sm:max-w-2xl\" layout=\"scrollable\" showCloseButton>\n      <DialogHeader>\n        <DialogTitle className=\"line-clamp-1\">{attachment.label}</DialogTitle>\n        <DialogDescription className=\"line-clamp-1\">\n          {attachment.meta ? (\n            <>\n              {attachment.meta} {\"\\u2022\"} {getAttachmentKind(attachment)}\n            </>\n          ) : (\n            getAttachmentKind(attachment)\n          )}\n        </DialogDescription>\n      </DialogHeader>\n\n      {customPreview ? (\n        customPreview\n      ) : (\n        <>\n          {hasImagePreview ? (\n            <div className=\"overflow-hidden rounded-md border bg-muted/20\">\n              <img\n                alt={attachment.previewAlt || attachment.label}\n                className=\"h-auto max-h-[60dvh] w-full object-contain\"\n                src={attachment.previewImageUrl}\n              />\n            </div>\n          ) : null}\n\n          {hasTextPreview ? (\n            <ScrollArea\n              className=\"max-h-[50dvh] rounded-md bg-muted/20\"\n              gradientScrollFade\n            >\n              <pre className=\"text-xs leading-5 whitespace-pre-wrap wrap-break-word px-3 py-2\">\n                {attachment.previewText}\n              </pre>\n            </ScrollArea>\n          ) : null}\n\n          {!hasImagePreview && !hasTextPreview ? (\n            <div className=\"rounded-md border bg-muted/20 p-4 text-sm text-muted-foreground\">\n              No preview available for this attachment.\n            </div>\n          ) : null}\n        </>\n      )}\n    </DialogContent>\n  );\n}\n\nfunction ChatInputAttachmentPreviewDialog({\n  attachment,\n  onOpenChange,\n  open,\n  renderPreview,\n}: ChatInputAttachmentPreviewDialogProps) {\n  if (!attachment) return null;\n\n  return (\n    <Dialog onOpenChange={onOpenChange} open={open}>\n      <ChatInputAttachmentPreviewContent\n        attachment={attachment}\n        renderPreview={renderPreview}\n      />\n    </Dialog>\n  );\n}\n\ninterface ChatInputProps extends Omit<HTMLMotionProps<\"div\">, \"onSubmit\"> {\n  attachmentPosition?: \"bottom\" | \"top\";\n  attachments?: ChatInputAttachmentData[];\n  disabled?: boolean;\n  isSubmitting?: boolean;\n  onAttachClick?: () => void;\n  onRemoveAttachment?: (id: string) => void;\n  onSubmit?: () => void;\n  onValueChange: (value: string) => void;\n  placeholder?: string;\n  renderAttachmentPreview?: (\n    attachment: ChatInputAttachmentData,\n  ) => React.ReactNode | undefined;\n  renderAttachment?: (attachment: ChatInputAttachmentData) => React.ReactNode;\n  rightActions?: React.ReactNode;\n  leftActions?: React.ReactNode;\n  value: string;\n  enableAttachmentPreview?: boolean;\n}\n\nfunction ChatInput({\n  attachmentPosition = \"top\",\n  attachments = [],\n  className,\n  disabled = false,\n  enableAttachmentPreview = true,\n  isSubmitting = false,\n  onAttachClick,\n  onRemoveAttachment,\n  onSubmit,\n  onValueChange,\n  placeholder = \"Type a message...\",\n  renderAttachmentPreview,\n  renderAttachment,\n  rightActions,\n  leftActions,\n  value,\n  ...props\n}: ChatInputProps) {\n  const attachmentPreviewDialogHandle = React.useMemo(\n    () => createDialogHandle<ChatInputAttachmentData>(),\n    [],\n  );\n  const hasAttachments = attachments.length > 0;\n  const hasSubmittableContent = value.trim().length > 0 || hasAttachments;\n  const submitDisabled =\n    disabled || isSubmitting || !hasSubmittableContent || !onSubmit;\n\n  const handleSubmit = () => {\n    if (submitDisabled) return;\n    onSubmit?.();\n  };\n\n  const attachmentsContent = (\n    <ScrollArea className=\"whitespace-nowrap\" gradientScrollFade noScrollBar>\n      <div className=\"flex w-max items-center space-x-4 p-2\">\n        {attachments.map((attachment) => (\n          <React.Fragment key={attachment.id}>\n            {renderAttachment ? (\n              renderAttachment(attachment)\n            ) : (\n              <ChatInputAttachmentItem>\n                <ChatInputAttachmentRemove\n                  onClick={() => {\n                    onRemoveAttachment?.(attachment.id);\n                  }}\n                />\n\n                {enableAttachmentPreview ? (\n                  <DialogTrigger\n                    handle={attachmentPreviewDialogHandle}\n                    payload={attachment}\n                    render={\n                      <Button\n                        className=\"relative size-full justify-start p-2 text-left cursor-pointer\"\n                        type=\"button\"\n                        variant=\"outline\"\n                      >\n                        <div className=\"flex size-full flex-col gap-1\">\n                          <ChatInputAttachmentLabel>\n                            {attachment.label}\n                          </ChatInputAttachmentLabel>\n                          {attachment.meta ? (\n                            <ChatInputAttachmentMeta>\n                              {attachment.meta}\n                            </ChatInputAttachmentMeta>\n                          ) : null}\n\n                          <div className=\"absolute bottom-2 left-2 rounded border px-1.5 py-0.5 text-[10px] uppercase text-muted-foreground\">\n                            {getAttachmentKind(attachment)}\n                          </div>\n                        </div>\n                      </Button>\n                    }\n                  />\n                ) : (\n                  <Button\n                    className=\"relative size-full justify-start p-2 text-left\"\n                    type=\"button\"\n                    variant=\"outline\"\n                  >\n                    <div className=\"flex size-full flex-col gap-1\">\n                      <ChatInputAttachmentLabel>\n                        {attachment.label}\n                      </ChatInputAttachmentLabel>\n                      {attachment.meta ? (\n                        <ChatInputAttachmentMeta>\n                          {attachment.meta}\n                        </ChatInputAttachmentMeta>\n                      ) : null}\n\n                      <div className=\"absolute bottom-2 left-2 rounded border px-1.5 py-0.5 text-[10px] uppercase text-muted-foreground\">\n                        {getAttachmentKind(attachment)}\n                      </div>\n                    </div>\n                  </Button>\n                )}\n              </ChatInputAttachmentItem>\n            )}\n          </React.Fragment>\n        ))}\n      </div>\n    </ScrollArea>\n  );\n\n  return (\n    <MotionConfig transition={chatInputTransition}>\n      <ChatInputRoot className={className} {...props}>\n        {hasAttachments && attachmentPosition === \"top\" ? (\n          <ChatInputAttachments position=\"top\">\n            {attachmentsContent}\n          </ChatInputAttachments>\n        ) : null}\n\n        <ChatInputTextarea\n          disabled={disabled}\n          onSubmitShortcut={handleSubmit}\n          onValueChange={onValueChange}\n          placeholder={placeholder}\n          value={value}\n        />\n\n        <ChatInputToolbar>\n          <ChatInputActions>\n            <TooltipProvider delay={100}>\n              {leftActions}\n              <ChatInputAttachButton\n                disabled={disabled}\n                onClick={onAttachClick}\n              />\n            </TooltipProvider>\n          </ChatInputActions>\n          <ChatInputActions>\n            {rightActions}\n            <ChatInputSubmitButton\n              disabled={submitDisabled}\n              isSubmitting={isSubmitting}\n              onClick={handleSubmit}\n            />\n          </ChatInputActions>\n        </ChatInputToolbar>\n\n        {hasAttachments && attachmentPosition === \"bottom\" ? (\n          <ChatInputAttachments position=\"bottom\">\n            {attachmentsContent}\n          </ChatInputAttachments>\n        ) : null}\n      </ChatInputRoot>\n\n      <Dialog handle={attachmentPreviewDialogHandle}>\n        {({ payload }) => {\n          if (!payload) return null;\n\n          return (\n            <ChatInputAttachmentPreviewContent\n              attachment={payload}\n              renderPreview={renderAttachmentPreview}\n            />\n          );\n        }}\n      </Dialog>\n    </MotionConfig>\n  );\n}\n\nexport {\n  ChatInputRoot,\n  ChatInputTextarea,\n  ChatInputToolbar,\n  ChatInputActions,\n  ChatInputSubmitButton,\n  ChatInputAttachButton,\n  ChatInputAttachments,\n  ChatInputAttachmentItem,\n  ChatInputAttachmentLabel,\n  ChatInputAttachmentMeta,\n  ChatInputAttachmentRemove,\n  ChatInputAttachmentPreviewDialog,\n  type ChatInputAttachmentData,\n  // Composite component\n  ChatInput,\n};\n",
      "type": "registry:ui",
      "target": "components/ai-elements/chat-input.tsx"
    }
  ],
  "categories": [
    "ai"
  ],
  "type": "registry:ui"
}