/* For popups */
@utility animate-popup {
  @apply origin-[var(--transform-origin)] transition-[opacity,scale,transform] ease-[cubic-bezier(0.23,1,0.32,1)] duration-150;

  &[data-starting-style],
  &[data-ending-style] {
    opacity: 0;
    scale: 0.95;
  }
}

/* For dialogs */
@utility animate-fade-up {
  @apply transition-all duration-300 ease-[cubic-bezier(0.25,1,0.5,1)];

  &[data-starting-style],
  &[data-ending-style] {
    opacity: 0;
    translate: 0 100%;
  }
}

@utility animate-fade-down {
  @apply transition-all duration-300 ease-[cubic-bezier(0.25,1,0.5,1)];

  &[data-starting-style],
  &[data-ending-style] {
    opacity: 0;
    translate: 0 -100%;
  }
}

@utility animate-slide-left {
  @apply transition-all duration-300 ease-[cubic-bezier(0.25,1,0.5,1)];

  &[data-starting-style],
  &[data-ending-style] {
    opacity: 0;
    translate: 100% 0;
  }
}

@utility animate-slide-right {
  @apply transition-all duration-300 ease-[cubic-bezier(0.25,1,0.5,1)];

  &[data-starting-style],
  &[data-ending-style] {
    opacity: 0;
    translate: -100% 0;
  }
}

@utility animate-fade-zoom {
  @apply transition-all duration-200 ease-[cubic-bezier(0.25,1,0.5,1)];

  &[data-starting-style],
  &[data-ending-style] {
    opacity: 0;
    scale: 0.94;
  }
}

@utility animate-fade {
  @apply transition-all duration-200;

  &[data-starting-style],
  &[data-ending-style] {
    opacity: 0;
  }
}

/* Overlay Outline */
@utility overlay-outline {
  @apply outline outline-border dark:-outline-offset-1;
}

/* Active Highlight */
@utility highlight-on-active {
  @apply data-highlighted:relative data-highlighted:z-0 data-highlighted:before:absolute data-highlighted:before:inset-x-1.5 data-highlighted:before:inset-y-0 data-highlighted:before:z-[-1] data-highlighted:before:rounded-md data-highlighted:before:bg-accent data-highlighted:text-accent-foreground;
}

/* 
   Toast Viewport
*/
@layer utilities {
  .toast-viewport {
    @apply fixed z-10 flex flex-col w-[var(--toast-max-width-mobile)] lg:w-[var(--toast-max-width-desktop)] outline-none pointer-events-none;
  }
  /* Viewport Positioning */
  .toast-viewport[data-position^="top"] { top: var(--toast-viewport-padding); bottom: auto; }
  .toast-viewport[data-position^="bottom"] { bottom: var(--toast-viewport-padding); top: auto; }

  .toast-viewport[data-position$="left"] { left: var(--toast-viewport-padding); right: auto; }
  .toast-viewport[data-position$="right"] { right: var(--toast-viewport-padding); left: auto; }
  .toast-viewport[data-position$="center"] { 
    @apply left-1/2 right-auto -translate-x-1/2;
  }
}

/* 
   Toast Root
*/
@layer utilities {
  .toast-root {
    @apply absolute w-full pointer-events-auto z-[calc(1000-var(--toast-index))];
    
    /* Transitions */
    transition: 
      transform 0.5s cubic-bezier(0.22, 1, 0.36, 1), 
      opacity 0.5s cubic-bezier(0.22, 1, 0.36, 1), 
      height 0.15s ease-out;
    
    /* Height Calculation */
    height: var(--toast-frontmost-height, var(--toast-height));
    
    /* Common Ghost Element (for hit areas) */
    &::after {
      content: "";
      position: absolute;
      left: 0;
      width: 100%;
      height: calc(var(--toast-gap) + 1px);
      background: transparent;
    }
    
    /* Math for collapsed stacking (shrinking effect) */
    --toast-scale: calc(max(0, 1 - (var(--toast-index) * 0.1)));
    --toast-shrink: calc(1 - var(--toast-scale));
    --toast-height-approx: var(--toast-frontmost-height, var(--toast-height));
  }
  /* 
    Positions
  */
  /* Bottom */
  .toast-root[data-position^="bottom"] {
    @apply bottom-0 top-auto;
    transform-origin: bottom center;

    /* Direction Multipliers: Bottom is "Positive" direction for entering from below */
    --dir-y: 1; 
    
    /* Calculate Offsets */
    --collapsed-offset-y: calc(
      (var(--toast-index) * var(--toast-peek) * -1) - /* Stack peek upwards */
      (var(--toast-shrink) * var(--toast-height-approx)) /* Shrink upwards */
    );
    
    --expanded-offset-y: calc(
      (var(--toast-offset-y) * -1) - /* Move up based on total stack height */
      (var(--toast-index) * var(--toast-gap))
    );

    /* Default Transform: Collapsed + Swipe Handling */
    transform: 
      translateX(var(--toast-swipe-movement-x, 0px)) 
      translateY(calc(var(--toast-swipe-movement-y, 0px) + var(--collapsed-offset-y))) 
      scale(var(--toast-scale));
  }

  /* Top */
  .toast-root[data-position^="top"] {
    @apply top-0 bottom-auto;
    transform-origin: top center;

    /* Direction Multipliers: Top is "Negative" direction for entering from above */
    --dir-y: -1;

    /* Calculate Offsets (Signs flipped from Bottom) */
    --collapsed-offset-y: calc(
      (var(--toast-index) * var(--toast-peek)) + /* Stack peek downwards */
      (var(--toast-shrink) * var(--toast-height-approx)) /* Shrink downwards */
    );
    
    --expanded-offset-y: calc(
      var(--toast-offset-y) + 
      (var(--toast-index) * var(--toast-gap))
    );

    /* Default Transform: Collapsed + Swipe Handling */
    transform: 
      translateX(var(--toast-swipe-movement-x, 0px)) 
      translateY(calc(var(--toast-swipe-movement-y, 0px) + var(--collapsed-offset-y))) 
      scale(var(--toast-scale));
  }
  
  /* 
    State Modifiers
  */
  /* Expanded State */
  .toast-root[data-expanded] {
    height: var(--toast-height);
    transform: 
      translateX(var(--toast-swipe-movement-x, 0px)) 
      translateY(var(--expanded-offset-y)) 
      scale(1);
  }
  /* Entering Animation */
  .toast-root[data-starting-style] {
    opacity: 0;
    transform: translateY(calc(var(--dir-y) * 150%));
  }
  /* Exiting Animation */
  .toast-root[data-ending-style] {
    opacity: 0;
    /* Default Exit */
    &:not([data-swipe-direction]) {
      transform: translateY(calc(var(--dir-y) * 150%));
    }
    /* Swipe Up/Down */
    &[data-swipe-direction="up"] {
      transform: translateY(calc(var(--toast-swipe-movement-y) - 150%));
    }
    &[data-swipe-direction="down"] {
      transform: translateY(calc(var(--toast-swipe-movement-y) + 150%));
    }
    /* Swipe Left/Right */
    &[data-swipe-direction="left"] {
      transform: 
        translateX(calc(var(--toast-swipe-movement-x) - 150%)) 
        translateY(var(--expanded-offset-y));
    }
    &[data-swipe-direction="right"] {
      transform: 
        translateX(calc(var(--toast-swipe-movement-x) + 150%)) 
        translateY(var(--expanded-offset-y));
    }
  }
  /* Limited State */
  .toast-root[data-limited] {
    opacity: 0;
    transform: scale(0.9);
  }
}
/*
   Drawer
*/
@layer utilities {
  .drawer-backdrop-motion {
    opacity: calc(var(--drawer-backdrop-opacity, 0.2) * (1 - var(--drawer-swipe-progress, 0)));
    transition-duration: 450ms;
    transition-property: opacity;
    transition-timing-function: cubic-bezier(0.32, 0.72, 0, 1);
  }

  .drawer-backdrop-motion[data-starting-style],
  .drawer-backdrop-motion[data-ending-style] {
    opacity: 0;
  }

  .drawer-backdrop-motion[data-swiping] {
    transition-duration: 0ms;
  }

  .drawer-backdrop-motion[data-ending-style] {
    transition-duration: calc(var(--drawer-swipe-strength, 1) * 400ms);
  }

  .drawer-popup-motion[data-swiping] {
    transition-duration: 0ms;
    user-select: none;
  }

  .drawer-popup-motion[data-ending-style] {
    transition-duration: calc(var(--drawer-swipe-strength, 1) * 400ms);
  }

  .drawer-popup-motion-bottom {
    transform: translateY(
      calc(var(--drawer-snap-point-offset, 0px) + var(--drawer-swipe-movement-y, 0px))
    );
  }

  .drawer-popup-motion-bottom[data-starting-style],
  .drawer-popup-motion-bottom[data-ending-style] {
    transform: translateY(calc(100% - var(--drawer-bleed, 3rem)));
  }

  .drawer-popup-motion-left {
    transform: translateX(var(--drawer-swipe-movement-x, 0px));
  }

  .drawer-popup-motion-left[data-starting-style],
  .drawer-popup-motion-left[data-ending-style] {
    transform: translateX(
      calc(-100% + var(--drawer-bleed, 3rem) - var(--drawer-viewport-padding, 0px))
    );
  }

  .drawer-popup-motion-right {
    transform: translateX(var(--drawer-swipe-movement-x, 0px));
  }

  .drawer-popup-motion-right[data-starting-style],
  .drawer-popup-motion-right[data-ending-style] {
    transform: translateX(
      calc(100% - var(--drawer-bleed, 3rem) + var(--drawer-viewport-padding, 0px))
    );
  }

  .drawer-popup-motion-top {
    transform: translateY(
      calc(var(--drawer-snap-point-offset, 0px) + var(--drawer-swipe-movement-y, 0px))
    );
  }

  .drawer-popup-motion-top[data-starting-style],
  .drawer-popup-motion-top[data-ending-style] {
    transform: translateY(calc(-100% + var(--drawer-bleed, 3rem)));
  }

  .drawer-popup-snap-bottom-motion {
    max-height: calc(100dvh - var(--drawer-top-margin, 0rem));
    padding-bottom: max(
      0px,
      calc(var(--drawer-snap-point-offset, 0px) + var(--drawer-swipe-movement-y, 0px))
    );
  }

  .drawer-popup-snap-bottom-motion::after {
    content: "";
    position: absolute;
    inset-inline: 0;
    top: 100%;
    height: var(--drawer-bleed, 3rem);
    background-color: inherit;
    pointer-events: none;
  }

  .drawer-popup-snap-bottom-motion[data-starting-style],
  .drawer-popup-snap-bottom-motion[data-ending-style] {
    transform: translateY(100%);
    padding-bottom: 0;
  }

  .drawer-popup-stacked-motion {
    --stack-step: 0.05;
    --stack-peek: 1rem;
    --stack-progress: clamp(0, var(--drawer-swipe-progress, 0), 1);
    --stack-peek-offset: max(
      0px,
      calc((var(--nested-drawers) - var(--stack-progress)) * var(--stack-peek))
    );
    --stack-scale-base: max(0, calc(1 - (var(--nested-drawers) * var(--stack-step))));
    --stack-scale: clamp(0, calc(var(--stack-scale-base) + (var(--stack-step) * var(--stack-progress))), 1);
    --stack-shrink: calc(1 - var(--stack-scale));
    --stack-height: max(
      0px,
      calc(var(--drawer-frontmost-height, var(--drawer-height)) - var(--drawer-bleed, 3rem))
    );
    transform-origin: 50% calc(100% - var(--drawer-bleed, 3rem));
    height: var(--drawer-height, auto);
  }

  .drawer-popup-stacked-motion[data-swipe-direction="down"]:not([data-starting-style]):not([data-ending-style]),
  .drawer-popup-stacked-motion:not([data-swipe-direction]):not([data-starting-style]):not([data-ending-style]) {
    transform: translateY(
      calc(
        var(--drawer-snap-point-offset, 0px) + var(--drawer-swipe-movement-y, 0px) -
          var(--stack-peek-offset) - (var(--stack-shrink) * var(--stack-height))
      )
    ) scale(var(--stack-scale));
  }

  .drawer-popup-stacked-motion[data-nested-drawer-open] {
    height: calc(var(--stack-height) + var(--drawer-bleed, 3rem));
    overflow: hidden;
  }

  .drawer-popup-stacked-motion[data-nested-drawer-open]::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background-color: rgb(0 0 0 / 0.05);
    pointer-events: none;
  }

  .drawer-popup-stacked-motion[data-nested-drawer-swiping] {
    transition-duration: 0ms;
  }

  .drawer-content-stacked-motion {
    transition: opacity 300ms;
  }

  [data-nested-drawer-open] .drawer-content-stacked-motion {
    opacity: 0;
  }

  [data-nested-drawer-open][data-nested-drawer-swiping] .drawer-content-stacked-motion {
    opacity: 1;
  }
}
